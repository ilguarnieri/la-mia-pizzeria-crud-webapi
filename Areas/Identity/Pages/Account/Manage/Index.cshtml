@page
@model CreatePizzaModel
@{
    ViewData["Title"] = "Dashboard - ";
    ViewData["ActivePage"] = ManageNavPages.Index;
}

<div class="d-flex flex-column flex-sm-row justify-content-between">
    <h3>Welcome @Model.Username</h3>
    <input type="text" placeholder="Cerca una pizza"/>
</div>
<hr />
<partial name="_StatusMessage" for="StatusMessage" />

<div row">

    <table class="table table-striped table-hover fw-bold">
      <thead>
        <tr>
          <th scope="col" class="t-visible">#</th>
          <th scope="col" class="t-visible">Immagine</th>
          <th scope="col">Nome</th>
          <th scope="col">Prezzo</th>
          <th scope="col" class="t-visible">Categoria</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody class="table-body">
      </tbody>
    </table>

</div>



@section Scripts{
<script>

let pizzas = [];
const table_body = document.querySelector('.table-body');

start();

function start(id) {

    table_body.innerHTML = '';
    
    getPizze(id);

    
}



//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - A X I O S
function getPizze(id) {

    axios.get('/api/pizzas', {
        params: {
            categoryId: id
        }
    })
    .then(res => {
        pizzas = res.data;
        pizzas.forEach(addPizza);
    })

    .catch(err => {
        console.log(err);
    })
}



//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - A D D - P I Z Z A
function addPizza(el, i) {

    //creazione  riga
    const newRow = document.createElement('tr');
    table_body.append(newRow);

    //index
    const newItem = document.createElement('th');
    newItem.getAttribute('scope', 'row');
    newItem.classList.add('t-visible');
    newItem.innerHTML = i;
    newRow.append(newItem);

    //img
    const imgItem = document.createElement('td');
    imgItem.classList.add('t-visible', 'table-img');
    newRow.append(imgItem);

    const imgTag = document.createElement('img');
    imgTag.classList.add('t-visible');
    imgTag.alt = 'foto-pizza';
    if (el.photo == null) {
        imgTag.src = '/img/back-no-pizza.png';
    } else {
        imgTag.src = el.photo;
    }
    imgItem.append(imgTag);

    //nome
    const nameItem = document.createElement('td');
    nameItem.innerHTML = el.name;
    newRow.append(nameItem);

    //price
    const priceItem = document.createElement('td');
    priceItem.innerHTML = `${el.price} €`;
    newRow.append(priceItem);

    //categoria
    const categoryItem = document.createElement('td');
    categoryItem.classList.add('t-visible');
    categoryItem.innerHTML = el.category.name;
    newRow.append(categoryItem);

    //buttion td
    const buttonItem = document.createElement('td');
    newRow.append(buttonItem);

    //view
    const btn_view = document.createElement('button');
    btn_view.classList.add('btn', 'btn-warning');
    btn_view.innerHTML = '<i class="fa-solid fa-eye"></i>';
    buttonItem.append(btn_view);

    //edit
    const btn_edit = document.createElement('button');
    btn_edit.classList.add('btn', 'btn-info');
    btn_edit.innerHTML = '<i class="fa-solid fa-pencil"></i>';
    buttonItem.append(btn_edit);

    //delete
    const btn_delete = document.createElement('button');
    btn_delete.classList.add('btn', 'btn-danger');
    btn_delete.innerHTML = '<i class="fa-regular fa-trash-can"></i>';
    buttonItem.append(btn_delete);
}

</script>
}